buildscript {
    repositories { maven { url "https://plugins.gradle.org/m2/" } }
    dependencies { classpath "gradle.plugin.nl.javadude.gradle.plugins:license-gradle-plugin:0.13.1" }
}

apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'eclipse'
apply plugin: 'maven'
apply plugin: "com.github.hierynomus.license"

sourceCompatibility = 1.8
version = '0.0.7'
jar {
    manifest {
        attributes 'Implementation-Title': 'JWT Permissions',
        'Implementation-Version': version
    }
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {

    compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.5'
    compile("org.springframework.boot:spring-boot-starter-security:1.4.2.RELEASE")
    compile("org.springframework.data:spring-data-jpa:1.10.5.RELEASE")

    compile("org.apache.openjpa:openjpa-persistence-jdbc:2.4.1") {
        exclude group: 'commons-logging', module: 'commons-logging'
        exclude group: 'junit', module: 'junit'
    }

    testCompile("com.h2database:h2:1.4.191")
    testCompile 'org.springframework:spring-test:4.2.6.RELEASE'
    testCompile 'org.spockframework:spock-core:1.0-groovy-2.4'
    testCompile 'org.spockframework:spock-spring:1.0-groovy-2.4'
    testCompile group: 'junit', name: 'junit', version: '4.+'
    testCompile 'cglib:cglib-nodep:2.2'
    testCompile group: 'junit', name: 'junit', version: '4.+'
    testCompile("org.springframework.boot:spring-boot-starter-web:1.4.2.RELEASE")
    testCompile("org.springframework.boot:spring-boot-starter-data-rest:1.4.2.RELEASE")
    testCompile("org.apache.httpcomponents:fluent-hc:4.5.1")
    testCompile("org.springframework.boot:spring-boot-starter-data-jpa:1.4.2.RELEASE")
}

configurations { deployerJars }

task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

license {
    header = file('header.txt')
    exclude "LICENSE.txt"
}

artifacts { archives sourcesJar }

uploadArchives {
    repositories {
        mavenDeployer {
            configuration = configurations.deployerJars
            repository(url: 'http://repository.dev.ebf.de/nexus/content/repositories/releases') {
                authentication(userName: "deployment", password: "ebf4ever")
            }
            pom.groupId = 'de.ebf'
            pom.artifactId = 'spring-granular-permissions'
            pom.version = rootProject.version
        }
    }
}

